{
  "track": "platform",
  "slug": "network-isolation",
  "title": "Network Isolation - NetworkPolicy Blocking Database",
  "type": "sre",
  "url_host": "network-isolation.localhost",
  "seed": true,
  "reset_strategy": "namespace-delete",
  "description": "A NetworkPolicy is blocking egress to the Postgres database, causing connection timeouts.",
  "symptoms": [
    "Database connection timeout errors in logs",
    "Application pods running but unresponsive",
    "Health checks failing"
  ],
  "fix_hints": [
    "Check NetworkPolicy rules in the namespace",
    "Verify egress is allowed to postgres service",
    "Apply corrected NetworkPolicy or delete the blocking one"
  ],
  "checks": {
    "version": 1,
    "default_stage": "broken",
    "stages": {
      "broken": {
        "verify": [
          {
            "type": "k8s.resourceExists",
            "description": "NetworkPolicy exists blocking database",
            "resource": { "kind": "NetworkPolicy", "name": "deny-db-egress" }
          },
          {
            "type": "k8s.podsContainLog",
            "description": "App logs show database timeout",
            "selector": "app=fider",
            "contains": "timeout",
            "since_seconds": 300
          },
          {
            "type": "http.get",
            "description": "Health endpoint is not healthy",
            "url": "http://network-isolation.localhost:8080/_health",
            "expect": { "status_not": [200] }
          }
        ],
        "health": [
          {
            "type": "k8s.podsContainLog",
            "description": "Timeout symptoms persist",
            "selector": "app=fider",
            "contains": "timeout",
            "since_seconds": 60
          }
        ]
      }
    }
  }
}
