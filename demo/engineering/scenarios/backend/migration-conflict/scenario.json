{
  "track": "backend",
  "slug": "migration-conflict",
  "title": "Migration Conflict - Duplicate Version",
  "type": "engineering",
  "url_host": "migration-conflict.localhost",
  "seed": true,
  "reset_strategy": "worktree-reset",
  "git": {
    "maintenance_branch": "scenario/backend/migration-conflict",
    "broken_ref": "scenario/backend/migration-conflict/broken",
    "solved_ref": "scenario/backend/migration-conflict/solved",
    "work_branch": "ws/backend/migration-conflict"
  },
  "description": "A database migration with a duplicate version prefix fails to apply.",
  "symptoms": [
    "Application fails to start",
    "Migration version conflict in logs",
    "Duplicate key error in migrations_history table"
  ],
  "fix_hints": [
    "Check migration file version prefixes",
    "Ensure each migration has a unique version",
    "Rename conflicting migration file"
  ],
  "checks": {
    "version": 1,
    "default_stage": "broken",
    "stages": {
      "broken": {
        "verify": [
          {
            "type": "http.get",
            "description": "Service fails to start due to migration conflict",
            "url": "http://migration-conflict.localhost:8082/_health",
            "expect": { "status": [503, 500] }
          }
        ]
      },
      "fixed": {
        "verify": [
          {
            "type": "http.get",
            "description": "Service starts successfully after migration fix",
            "url": "http://migration-conflict.localhost:8082/_health",
            "expect": { "status": [200] }
          }
        ]
      }
    }
  }
}
